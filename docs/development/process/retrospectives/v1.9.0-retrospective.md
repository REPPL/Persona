# Retrospective: v1.9.0 - Experiment Infrastructure

## Overview

| Metric | Value |
|--------|-------|
| Features Delivered | 2 |
| Unit Tests Added | 83 |
| New CLI Commands | 13 |
| Test Coverage | ~86% (new code) |

---

## What Went Well

### 1. W3C PROV Compliance

Adopting the W3C PROV data model for lineage tracking ensures interoperability with other provenance tools. The PROV-JSON export format is widely supported.

### 2. SQLite Choice

Using SQLite for both experiment and lineage storage proved excellent:
- Zero configuration for users
- Portable databases travel with projects
- Sufficient query capability for graph traversal
- No external dependencies

### 3. Graph Traversal Implementation

The ancestor/descendant/full-lineage traversal algorithms work correctly and efficiently. Depth limiting prevents runaway queries on complex graphs.

### 4. Clean Separation of Concerns

Clear separation between:
- Models (dataclasses) - Data structure
- Store (abstract) - Interface contract
- SQLite Store - Implementation
- CLI Commands - User interface

### 5. Building on v1.8.0 Foundations

The v1.8.0 technical debt cleanup made v1.9.0 development smoother:
- CLIContext pattern reused for new commands
- Lazy loading pattern applied to new modules
- Quality command patterns informed CLI design

---

## What Could Improve

### 1. Integration with Generation Pipeline

F-124 and F-125 provide infrastructure but aren't yet integrated into the main generation pipeline. Future work should automatically:
- Create lineage records during generation
- Associate runs with experiments
- Track intermediate outputs

### 2. CLI Discoverability

Both `variant` and `lineage` commands are hidden. Users need to know they exist. Consider:
- Adding to `persona help advanced`
- Mentioning in tutorials
- Better documentation in CLI reference

### 3. Migration Path

No migration tooling exists for converting file-based experiment data to SQLite. Users with existing experiments need manual migration.

---

## Lessons Learned

### 1. PROV Model Complexity

The W3C PROV model is powerful but complex. Started with a simplified subset (Entity, Activity, Agent, basic relations) rather than implementing the full specification.

### 2. SQL Security Vigilance

Security scanners flag dynamic SQL even when safe. Document reasoning with `# nosec` comments to prevent future confusion.

### 3. Hidden Commands Are Discoverable Enough

Making advanced commands hidden keeps the main help clean without truly hiding functionality. Power users find them via documentation or `--help` on subcommands.

---

## Metrics

### Code Statistics

| Category | Files | Lines |
|----------|-------|-------|
| F-124 Core | 4 | ~1,200 |
| F-124 CLI | 2 | ~400 |
| F-125 Core | 5 | ~1,600 |
| F-125 CLI | 1 | ~700 |
| Unit Tests | 8 | ~1,500 |

### Test Results

| Feature | Tests | Passing | Coverage |
|---------|-------|---------|----------|
| F-124 | 29 | 29 | ~85% |
| F-125 | 54 | 54 | ~87% |
| **Total** | **83** | **83** | **~86%** |

### CLI Commands Added

| Command Group | Subcommands |
|---------------|-------------|
| `project` | list, create, register, unregister, show, add-source, remove-source, defaults, init-registry |
| `variant` | create, list, show, update, delete, compare |
| `lineage` | list, show, trace, verify, export, agents, activities |

---

## Action Items for Future Releases

### Integration Work

- [ ] Auto-record lineage during generation
- [ ] Link experiments to lineage graphs
- [ ] Add provenance to persona output files

### Usability

- [ ] Add experiment/lineage to interactive wizard
- [ ] Create user tutorials for research workflows
- [ ] Add `persona help advanced` command

### Migration

- [ ] Create migration tool for existing experiments
- [ ] Document upgrade path from file-based storage

---

## Summary

v1.9.0 delivers solid research infrastructure foundations. The experiment management and data lineage systems are well-designed, thoroughly tested, and ready for production use. The main gap is integration with the generation pipeline, which should be addressed in a future release.

---

## Team Notes

- Implementation used Claude Code with context continuation
- All code follows British English conventions
- GPL-3.0 licence compliance maintained

---

## Related Documentation

- [v1.9.0 DevLog](../devlogs/v1.9.0-devlog.md)
- [v1.9.0 Milestone](../../roadmap/milestones/v1.9.0.md)
- [F-124: Experiment Management](../../roadmap/features/completed/F-124-experiment-management.md)
- [F-125: Data Lineage](../../roadmap/features/completed/F-125-data-lineage-provenance.md)
- [Retrospectives Index](README.md)

---

**Status**: Complete
