# Manual Test Script: v1.3.0 - Local Model Foundation

## Prerequisites

### For Ollama Tests (F-112)
- [ ] Ollama installed (`ollama --version`)
- [ ] At least one model pulled (`ollama list`)
- [ ] Ollama service running (`ollama serve` or system service)

### For Privacy Tests (F-113)
- [ ] Privacy extras installed (`pip install persona[privacy]`)
- [ ] spaCy model downloaded (`python -m spacy download en_core_web_lg`)

---

## F-112: Native Ollama Provider

### Test 1: Ollama Health Check
```bash
persona health --provider ollama
```
- [ ] Shows "Ollama: Connected" or clear error if not running
- [ ] Lists available models if connected

### Test 2: List Ollama Models
```bash
persona models --provider ollama
```
- [ ] Lists all locally available models
- [ ] Shows model names matching `ollama list` output
- [ ] Handles gracefully if Ollama not running

### Test 3: Generate with Ollama (Requires Ollama Running)
```bash
# Create test data
echo "User feedback: The app is great but needs dark mode" > /tmp/test_data.txt

# Generate with Ollama
persona generate --input /tmp/test_data.txt --provider ollama --model llama3.2:3b --count 1
```
- [ ] Generation starts without errors
- [ ] Progress displayed during generation
- [ ] Persona JSON created successfully
- [ ] No API calls to cloud providers (check network if possible)

### Test 4: Ollama Not Running
```bash
# Stop Ollama first
ollama stop  # or systemctl stop ollama

persona generate --input /tmp/test_data.txt --provider ollama
```
- [ ] Clear error message displayed
- [ ] Suggests starting Ollama
- [ ] No cryptic stack traces

### Test 5: Model Not Available
```bash
persona generate --input /tmp/test_data.txt --provider ollama --model nonexistent:model
```
- [ ] Clear error about model not found
- [ ] Suggests available models or `ollama pull`

---

## F-113: PII Detection & Anonymisation

### Test 6: Privacy Module Not Installed
```bash
# In a fresh venv without [privacy] extra
pip install persona  # without [privacy]
persona privacy scan --input /tmp/test_data.txt
```
- [ ] Clear error message about missing module
- [ ] Shows installation command: `pip install persona[privacy]`

### Test 7: PII Scan - No PII
```bash
echo "The weather is nice today." > /tmp/no_pii.txt
persona privacy scan --input /tmp/no_pii.txt
```
- [ ] Reports no PII detected
- [ ] Clean output without errors

### Test 8: PII Scan - With PII
```bash
cat > /tmp/with_pii.txt << 'EOF'
Interview with John Smith on 15/03/1985.
Contact: john.smith@example.com, +44 20 7946 0958
Location: 123 Main Street, London
EOF

persona privacy scan --input /tmp/with_pii.txt
```
- [ ] Detects PERSON (John Smith)
- [ ] Detects EMAIL_ADDRESS
- [ ] Detects PHONE_NUMBER
- [ ] Detects LOCATION
- [ ] Shows entity counts and examples

### Test 9: PII Scan - JSON Output
```bash
persona privacy scan --input /tmp/with_pii.txt --json
```
- [ ] Valid JSON output
- [ ] Contains detected entities with positions
- [ ] Machine-parseable format

### Test 10: PII Scan - Custom Threshold
```bash
persona privacy scan --input /tmp/with_pii.txt --threshold 0.9
```
- [ ] Fewer detections with higher threshold
- [ ] Only high-confidence matches shown

### Test 11: PII Scan - Filter Entities
```bash
persona privacy scan --input /tmp/with_pii.txt --entities PERSON,EMAIL_ADDRESS
```
- [ ] Only shows PERSON and EMAIL entities
- [ ] Other entity types not reported

### Test 12: Anonymise - Redact Strategy (Default)
```bash
persona privacy anonymise --input /tmp/with_pii.txt --output /tmp/redacted.txt
cat /tmp/redacted.txt
```
- [ ] Output file created
- [ ] John Smith → [PERSON]
- [ ] Email → [EMAIL_ADDRESS]
- [ ] Phone → [PHONE_NUMBER]
- [ ] Original meaning preserved

### Test 13: Anonymise - Replace Strategy
```bash
persona privacy anonymise --input /tmp/with_pii.txt --output /tmp/replaced.txt --strategy replace
cat /tmp/replaced.txt
```
- [ ] Output file created
- [ ] Names replaced with realistic fake names
- [ ] Emails replaced with anonymous@example.com style
- [ ] Text remains readable

### Test 14: Anonymise - Hash Strategy
```bash
persona privacy anonymise --input /tmp/with_pii.txt --output /tmp/hashed.txt --strategy hash
cat /tmp/hashed.txt
```
- [ ] Output file created
- [ ] PII replaced with hash strings
- [ ] Same entity produces same hash (deterministic)

### Test 15: Anonymise - Force Overwrite
```bash
# First run creates file
persona privacy anonymise --input /tmp/with_pii.txt --output /tmp/safe.txt

# Second run without --force should fail
persona privacy anonymise --input /tmp/with_pii.txt --output /tmp/safe.txt
# Should see error about existing file

# With --force should succeed
persona privacy anonymise --input /tmp/with_pii.txt --output /tmp/safe.txt --force
```
- [ ] First run succeeds
- [ ] Second run (no --force) shows error
- [ ] Third run (with --force) overwrites successfully

### Test 16: Generate with Anonymisation
```bash
persona generate --from /tmp/with_pii.txt --anonymise --provider anthropic --count 1
```
- [ ] Shows "Anonymising input data..." message
- [ ] Reports number of PII entities anonymised
- [ ] Generation proceeds with anonymised data
- [ ] Output personas don't contain original PII

### Test 17: Generate with Anonymisation Strategy
```bash
persona generate --from /tmp/with_pii.txt --anonymise --anonymise-strategy replace --provider anthropic --count 1
```
- [ ] Uses replace strategy (not redact)
- [ ] Personas have realistic replacement data

---

## Integration Tests

### Test 18: Full Local Privacy Workflow
```bash
# Complete air-gapped workflow
cat > /tmp/sensitive_interview.txt << 'EOF'
Interview participant: Sarah Johnson, age 34
Email: sarah.j@company.com
She mentioned frustration with the checkout process.
"I always have to re-enter my card number 4532-1234-5678-9012"
EOF

# Step 1: Scan
persona privacy scan --input /tmp/sensitive_interview.txt

# Step 2: Anonymise
persona privacy anonymise --input /tmp/sensitive_interview.txt --output /tmp/safe_interview.txt --strategy redact

# Step 3: Generate with local Ollama
persona generate --input /tmp/safe_interview.txt --provider ollama --model llama3.2:3b --count 1
```
- [ ] Scan detects: PERSON, EMAIL, CREDIT_CARD
- [ ] Anonymised file contains no PII
- [ ] Local generation succeeds
- [ ] No data sent to cloud (verify network if possible)

### Test 19: Combined Anonymise + Generate
```bash
# Single command workflow
persona generate --from /tmp/sensitive_interview.txt --anonymise --provider ollama --model llama3.2:3b --count 1
```
- [ ] Anonymisation happens automatically
- [ ] Generation uses anonymised data
- [ ] Single command for full workflow

---

## Error Handling

### Test 20: Invalid Input File
```bash
persona privacy scan --input /nonexistent/file.txt
```
- [ ] Clear error about file not found
- [ ] No stack trace

### Test 21: Invalid Strategy
```bash
persona privacy anonymise --input /tmp/with_pii.txt --strategy invalid
```
- [ ] Clear error about invalid strategy
- [ ] Lists valid strategies

### Test 22: Help Commands
```bash
persona privacy --help
persona privacy scan --help
persona privacy anonymise --help
```
- [ ] All help text displays correctly
- [ ] Options documented
- [ ] Examples provided where appropriate

---

## Performance (Optional)

### Test 23: Large File Scan
```bash
# Create large test file (1000 lines)
for i in {1..1000}; do
  echo "User $i (user$i@example.com) said: feedback line $i"
done > /tmp/large_pii.txt

time persona privacy scan --input /tmp/large_pii.txt
```
- [ ] Completes in reasonable time (< 30 seconds)
- [ ] Memory usage acceptable
- [ ] All entities detected

---

## Cleanup

```bash
rm -f /tmp/test_data.txt /tmp/no_pii.txt /tmp/with_pii.txt
rm -f /tmp/redacted.txt /tmp/replaced.txt /tmp/hashed.txt /tmp/safe.txt
rm -f /tmp/sensitive_interview.txt /tmp/safe_interview.txt /tmp/large_pii.txt
```

---

## Test Results Summary

| Test | Pass | Fail | Notes |
|------|------|------|-------|
| 1. Ollama Health | | | |
| 2. List Models | | | |
| 3. Generate Ollama | | | |
| 4. Ollama Not Running | | | |
| 5. Model Not Available | | | |
| 6. Privacy Not Installed | | | |
| 7. Scan No PII | | | |
| 8. Scan With PII | | | |
| 9. Scan JSON | | | |
| 10. Scan Threshold | | | |
| 11. Scan Entities | | | |
| 12. Anonymise Redact | | | |
| 13. Anonymise Replace | | | |
| 14. Anonymise Hash | | | |
| 15. Force Overwrite | | | |
| 16. Generate Anonymise | | | |
| 17. Generate Strategy | | | |
| 18. Local Workflow | | | |
| 19. Combined Command | | | |
| 20. Invalid Input | | | |
| 21. Invalid Strategy | | | |
| 22. Help Commands | | | |
| 23. Large File | | | |

**Tester:** _______________
**Date:** _______________
**Version:** v1.3.0
**Platform:** _______________
