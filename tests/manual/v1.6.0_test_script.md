# Manual Test Script: v1.6.0 - Academic Validation

## Prerequisites

### For Academic Metrics (F-117)
- [ ] Academic extras installed (`pip install persona[academic]`)
- [ ] `rouge-score` and `bert-score` packages available
- [ ] Optional: OpenAI API key for GPT-similarity metric

### For Hallucination Detection (F-118)
- [ ] HHEM model will download on first use (~500MB)
- [ ] Source data available for faithfulness validation

---

## F-117: Academic Validation Metrics

### Test 1: Basic Academic Validation
```bash
# Create test persona and source
cat > /tmp/test_persona.json << 'EOF'
{
  "name": "Alex Chen",
  "age": 34,
  "occupation": "Software Engineer",
  "goals": ["Build efficient systems", "Learn new technologies"],
  "frustrations": ["Slow build times", "Unclear documentation"],
  "background": "Alex has 10 years of experience in backend development."
}
EOF

cat > /tmp/source_data.txt << 'EOF'
User research summary:
- Engineers want faster build systems
- Documentation is frequently cited as pain point
- Most participants have 5-15 years experience
- Learning and growth are top priorities
EOF

persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt
```
- [ ] ROUGE-L score displayed (0.0-1.0)
- [ ] BERTScore displayed (0.0-1.0)
- [ ] Overall academic score shown
- [ ] No errors during validation

### Test 2: ROUGE-L Metric Only
```bash
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt --metrics rouge
```
- [ ] Only ROUGE-L score shown
- [ ] Faster execution (no BERT)

### Test 3: BERTScore Metric Only
```bash
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt --metrics bert
```
- [ ] Only BERTScore shown
- [ ] Shows precision, recall, F1

### Test 4: All Metrics (Including Optional)
```bash
# Requires OpenAI API key
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt --metrics all
```
- [ ] ROUGE-L displayed
- [ ] BERTScore displayed
- [ ] GPT-similarity displayed (if API key set)
- [ ] G-eval displayed (if API key set)
- [ ] Graceful skip if API key not available

### Test 5: Batch Validation
```bash
cat > /tmp/personas_batch.json << 'EOF'
[
  {"name": "Alex", "occupation": "Engineer", "goals": ["Build systems"]},
  {"name": "Maria", "occupation": "Designer", "goals": ["Create interfaces"]},
  {"name": "James", "occupation": "Manager", "goals": ["Ship products"]}
]
EOF

persona academic validate /tmp/personas_batch.json --source /tmp/source_data.txt
```
- [ ] All three personas validated
- [ ] Individual scores shown
- [ ] Average/aggregate score displayed

### Test 6: JSON Output
```bash
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt --json
```
- [ ] Valid JSON output
- [ ] Contains all metric scores
- [ ] Machine-parseable

### Test 7: Markdown Report
```bash
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt --report /tmp/academic_report.md
cat /tmp/academic_report.md
```
- [ ] Report file created
- [ ] Contains formatted scores
- [ ] Suitable for documentation

### Test 8: Generate PPS Survey Template
```bash
persona academic pps-survey /tmp/test_persona.json --output /tmp/pps_survey.md
cat /tmp/pps_survey.md
```
- [ ] Survey template created
- [ ] Contains 28 items (Persona Perception Scale)
- [ ] Persona details embedded
- [ ] Ready for human validation

### Test 9: Threshold Check
```bash
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt --threshold 0.7
echo "Exit code: $?"
```
- [ ] Exit code 0 if score >= 0.7
- [ ] Exit code 1 if score < 0.7
- [ ] Clear pass/fail message

---

## F-118: Hallucination Detection

### Test 10: Basic Faithfulness Validation
```bash
persona faithfulness check /tmp/test_persona.json --source /tmp/source_data.txt
```
- [ ] Faithfulness score displayed (0.0-1.0)
- [ ] Hallucination rate shown
- [ ] Supported claims listed
- [ ] Unsupported claims (hallucinations) listed

### Test 11: Faithfulness with HHEM
```bash
persona faithfulness check /tmp/test_persona.json --source /tmp/source_data.txt --hhem
```
- [ ] Uses HHEM classifier (downloads model on first run)
- [ ] Fast local inference
- [ ] No API calls required

### Test 12: Detect Hallucinations
```bash
# Create persona with hallucinated content
cat > /tmp/hallucinated_persona.json << 'EOF'
{
  "name": "Alex Chen",
  "age": 34,
  "occupation": "Software Engineer",
  "company": "TechCorp Inc",
  "salary": "$150,000",
  "goals": ["Build efficient systems"],
  "background": "Alex graduated from MIT with honors."
}
EOF

persona faithfulness check /tmp/hallucinated_persona.json --source /tmp/source_data.txt
```
- [ ] Detects "TechCorp Inc" as unsupported
- [ ] Detects "$150,000" as unsupported
- [ ] Detects "MIT" as unsupported
- [ ] Faithfulness score < 1.0

### Test 13: High-Fidelity Persona
```bash
# Create persona closely matching source
cat > /tmp/faithful_persona.json << 'EOF'
{
  "name": "Anonymous Engineer",
  "occupation": "Software Engineer",
  "experience": "10 years in backend development",
  "goals": ["Build faster systems", "Learn new technologies"],
  "frustrations": ["Slow builds", "Poor documentation"]
}
EOF

persona faithfulness check /tmp/faithful_persona.json --source /tmp/source_data.txt
```
- [ ] High faithfulness score (> 0.8)
- [ ] Few or no unsupported claims
- [ ] Most claims match source

### Test 14: Claim Extraction
```bash
persona faithfulness claims /tmp/test_persona.json
```
- [ ] Lists all extracted claims
- [ ] Shows claim source (which attribute)
- [ ] Claims are atomic statements

### Test 15: Faithfulness JSON Output
```bash
persona faithfulness check /tmp/test_persona.json --source /tmp/source_data.txt --json
```
- [ ] Valid JSON output
- [ ] Contains claims list
- [ ] Contains support evidence
- [ ] Contains hallucination flags

### Test 16: Batch Faithfulness
```bash
persona faithfulness check /tmp/personas_batch.json --source /tmp/source_data.txt
```
- [ ] All personas checked
- [ ] Individual scores shown
- [ ] Aggregate statistics displayed

### Test 17: Faithfulness Threshold
```bash
persona faithfulness check /tmp/test_persona.json --source /tmp/source_data.txt --threshold 0.85
echo "Exit code: $?"
```
- [ ] Exit code 0 if faithfulness >= 0.85
- [ ] Exit code 1 if faithfulness < 0.85

---

## Integration Tests

### Test 18: Combined Academic + Faithfulness
```bash
persona validate /tmp/test_persona.json --academic --faithfulness --source /tmp/source_data.txt
```
- [ ] Both validations run
- [ ] Academic metrics shown
- [ ] Faithfulness score shown
- [ ] Combined report

### Test 19: Full Validation Report
```bash
persona validate /tmp/test_persona.json \
  --academic \
  --faithfulness \
  --source /tmp/source_data.txt \
  --report /tmp/full_validation.md

cat /tmp/full_validation.md
```
- [ ] Comprehensive report generated
- [ ] Academic section included
- [ ] Faithfulness section included
- [ ] Actionable insights

### Test 20: Validate Generated Personas
```bash
# Generate then validate
persona generate --input /tmp/source_data.txt --provider ollama --count 2 --output /tmp/generated

persona validate /tmp/generated/personas.json \
  --academic \
  --faithfulness \
  --source /tmp/source_data.txt
```
- [ ] Generated personas validate correctly
- [ ] Scores reflect quality
- [ ] Hallucinations detected if present

### Test 21: Research Workflow
```bash
# Complete academic validation workflow
# 1. Generate personas
persona generate --input /tmp/source_data.txt --hybrid --count 3 --output /tmp/research_personas

# 2. Academic validation
persona academic validate /tmp/research_personas/personas.json --source /tmp/source_data.txt --report /tmp/academic.md

# 3. Faithfulness check
persona faithfulness check /tmp/research_personas/personas.json --source /tmp/source_data.txt --hhem

# 4. Generate PPS survey for human validation
persona academic pps-survey /tmp/research_personas/personas.json --output /tmp/survey.md
```
- [ ] All steps complete
- [ ] Reports suitable for academic paper
- [ ] Survey ready for participants

---

## Error Handling

### Test 22: Missing Source File
```bash
persona academic validate /tmp/test_persona.json --source /nonexistent/file.txt
```
- [ ] Clear error about missing source
- [ ] No stack trace

### Test 23: Invalid Metric Name
```bash
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt --metrics invalid
```
- [ ] Clear error about invalid metric
- [ ] Lists valid options

### Test 24: Academic Extras Not Installed
```bash
# In fresh venv without [academic]
pip install persona  # without [academic]
persona academic validate /tmp/test_persona.json --source /tmp/source_data.txt
```
- [ ] Clear error about missing dependencies
- [ ] Shows installation command

### Test 25: Help Commands
```bash
persona academic --help
persona academic validate --help
persona academic pps-survey --help
persona faithfulness --help
persona faithfulness check --help
```
- [ ] All help text displays
- [ ] Options documented
- [ ] Examples provided

---

## Performance Tests

### Test 26: BERTScore Performance
```bash
# Large batch test
time persona academic validate /tmp/personas_batch.json --source /tmp/source_data.txt --metrics bert
```
- [ ] Completes in reasonable time
- [ ] Progress feedback shown
- [ ] Memory usage acceptable

### Test 27: HHEM Performance
```bash
# First run downloads model
time persona faithfulness check /tmp/test_persona.json --source /tmp/source_data.txt --hhem
```
- [ ] Model downloads if needed
- [ ] Subsequent runs faster (cached)
- [ ] Local inference quick

---

## Cleanup

```bash
rm -f /tmp/test_persona.json /tmp/source_data.txt
rm -f /tmp/personas_batch.json
rm -f /tmp/hallucinated_persona.json /tmp/faithful_persona.json
rm -f /tmp/academic_report.md /tmp/pps_survey.md /tmp/full_validation.md
rm -rf /tmp/generated /tmp/research_personas
rm -f /tmp/academic.md /tmp/survey.md
```

---

## Test Results Summary

| Test | Pass | Fail | Notes |
|------|------|------|-------|
| 1. Basic Academic | | | |
| 2. ROUGE-L Only | | | |
| 3. BERTScore Only | | | |
| 4. All Metrics | | | |
| 5. Batch Validation | | | |
| 6. JSON Output | | | |
| 7. Markdown Report | | | |
| 8. PPS Survey | | | |
| 9. Threshold Check | | | |
| 10. Basic Faithfulness | | | |
| 11. HHEM Classifier | | | |
| 12. Detect Hallucinations | | | |
| 13. High-Fidelity | | | |
| 14. Claim Extraction | | | |
| 15. Faithfulness JSON | | | |
| 16. Batch Faithfulness | | | |
| 17. Faithfulness Threshold | | | |
| 18. Combined Validation | | | |
| 19. Full Report | | | |
| 20. Validate Generated | | | |
| 21. Research Workflow | | | |
| 22. Missing Source | | | |
| 23. Invalid Metric | | | |
| 24. Extras Not Installed | | | |
| 25. Help Commands | | | |
| 26. BERTScore Perf | | | |
| 27. HHEM Perf | | | |

**Tester:** _______________
**Date:** _______________
**Version:** v1.6.0
**Platform:** _______________

---

## Metric Reference

| Metric | Range | Good Score | Description |
|--------|-------|------------|-------------|
| ROUGE-L | 0.0-1.0 | > 0.5 | Lexical overlap |
| BERTScore | 0.0-1.0 | > 0.8 | Semantic similarity |
| GPT-similarity | 0.0-1.0 | > 0.75 | Embedding distance |
| G-eval | 0.0-1.0 | > 0.7 | Information validity |
| Faithfulness | 0.0-1.0 | > 0.85 | Claims supported by source |
