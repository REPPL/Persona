# Smoke Test: v0.4.0 (5-10 minutes)

## Prerequisites

```bash
cd ~/Development/Sandboxed/Persona
source .venv/bin/activate
pip install -e ".[all]"
```

## Quick Verification

### 1. Version Check
```bash
python -c "import persona; print(persona.__version__)"
```
- [ ] Shows `0.4.0`

### 2. Formatter Registry (F-039)
```bash
python -c "
from persona.core.output import get_registry, OutputSection, SectionConfig

registry = get_registry()
print('Registered formatters:', list(registry.list_formatters().keys()))
print('Output sections:', [s.value for s in OutputSection])

# Test section presets
minimal = SectionConfig.minimal_preset()
full = SectionConfig.full_preset()
print('Minimal sections:', len([s for s in OutputSection if minimal.is_enabled(s)]))
print('Full sections:', len([s for s in OutputSection if full.is_enabled(s)]))
"
```
- [ ] Shows registered formatters
- [ ] Shows output sections
- [ ] Minimal has fewer sections than full

### 3. Narrative Formatter (F-036)
```bash
python -c "
from persona.core.output import NarrativeFormatter, NarrativeConfig, Perspective
from persona.core.generation.parser import Persona

persona = Persona(
    id='test-001',
    name='Test User',
    goals=['Improve efficiency'],
    pain_points=['Manual processes'],
    behaviours=['Uses keyboard shortcuts'],
    quotes=['I need things to be faster'],
    demographics={'role': 'Developer', 'age': '30'}
)

# First person
config = NarrativeConfig(perspective=Perspective.FIRST_PERSON)
formatter = NarrativeFormatter(config)
result = formatter.format(persona)
print('=== First Person ===')
print(result[:500])
"
```
- [ ] Generates first-person narrative ("I am...", "My goals...")
- [ ] Contains persona details

### 4. Table Formatter (F-037)
```bash
python -c "
from persona.core.output import PersonaComparisonTable, TableOutputFormat, TableConfig
from persona.core.generation.parser import Persona

personas = [
    Persona(id='p1', name='Developer Dan', goals=['Code faster'], pain_points=['Slow builds'], behaviours=[], quotes=[]),
    Persona(id='p2', name='Designer Diana', goals=['Better UX'], pain_points=['Poor tools'], behaviours=[], quotes=[]),
]

table = PersonaComparisonTable(personas)
print('=== Markdown Table ===')
print(table.format(TableOutputFormat.MARKDOWN))
print()
print('=== ASCII Table ===')
print(table.format(TableOutputFormat.ASCII)[:500])
"
```
- [ ] Generates readable markdown table
- [ ] Generates ASCII art table with borders

### 5. Usage Scenario Generator (F-038)
```bash
python -c "
from persona.core.output import UsageScenarioGenerator, ProductContext
from persona.core.generation.parser import Persona

persona = Persona(
    id='test-001',
    name='Sarah',
    goals=['Find information quickly'],
    pain_points=['Too many clicks'],
    behaviours=['Power user', 'Uses search'],
    quotes=[],
    demographics={'role': 'Analyst'}
)

generator = UsageScenarioGenerator()
scenarios = generator.generate(persona)
print(f'Generated {len(scenarios)} scenarios')
for s in scenarios[:2]:
    print(f'- {s.scenario_name}: {s.narrative[:100]}...')
"
```
- [ ] Generates usage scenarios
- [ ] Scenarios have names and narratives

### 6. README Generator (F-041)
```bash
python -c "
from persona.core.output import ReadmeGenerator, GenerationSummary, PersonaSummary
from datetime import datetime

summary = GenerationSummary(
    title='Test Generation',
    generated_at=datetime.now(),
    data_source='test.csv',
    persona_count=3,
    personas=[
        PersonaSummary(id='p1', name='Alice', summary='Power user'),
        PersonaSummary(id='p2', name='Bob', summary='Casual user'),
    ],
    model_used='claude-sonnet-4.5',
    experiment_id='exp-001'
)

generator = ReadmeGenerator()
readme = generator.generate(summary)
print(readme[:800])
"
```
- [ ] Generates valid markdown README
- [ ] Contains generation metadata

### 7. Response Capture (F-042)
```bash
python -c "
from persona.core.output import ResponseCaptureManager, create_request_capture
import tempfile
import os

with tempfile.TemporaryDirectory() as tmpdir:
    manager = ResponseCaptureManager(tmpdir)
    session_id = manager.start_session('test-session')

    # Capture a request/response
    request = create_request_capture(
        provider='anthropic',
        model='claude-sonnet-4.5',
        messages=[{'role': 'user', 'content': 'Hello'}]
    )
    manager.capture_response(
        session_id,
        request,
        {'content': 'Hi there!'},
        latency_ms=150.0
    )

    manager.end_session(session_id)
    print(f'Session captured: {session_id}')
    print(f'Files created: {os.listdir(tmpdir)}')
"
```
- [ ] Session created successfully
- [ ] Files created in output directory

### 8. Conversation Scripts (F-086)
```bash
python -c "
from persona.core.scripts import ConversationScriptGenerator, ScriptFormat, PrivacyConfig
from persona.core.generation.parser import Persona

persona = Persona(
    id='test-001',
    name='Maya Chen',
    goals=['Streamline workflows', 'Learn new tools'],
    pain_points=['Manual data entry', 'Slow systems'],
    behaviours=['Reviews dashboards daily', 'Prefers keyboard navigation'],
    quotes=['I wish I could automate this', 'Data drives my decisions'],
    demographics={'role': 'Product Manager', 'age': '32', 'experience': '8 years'}
)

generator = ConversationScriptGenerator()
result = generator.generate(persona, ScriptFormat.CHARACTER_CARD)

print(f'Blocked: {result.blocked}')
print(f'Privacy audit passed: {result.privacy_audit.passed}')
print(f'Leakage score: {result.privacy_audit.leakage_score:.3f}')
print()
print('=== Character Card (first 800 chars) ===')
print(result.output[:800])
"
```
- [ ] Generation not blocked
- [ ] Privacy audit passes
- [ ] Character card contains abstracted content (not raw quotes)

### 9. Privacy Audit Verification
```bash
python -c "
from persona.core.scripts import PrivacyAuditor, PrivacyConfig
from persona.core.scripts.models import CharacterCard, Identity, PsychologicalProfile, CommunicationStyle, KnowledgeBoundaries, Guidelines, Provenance
from persona.core.generation.parser import Persona

# Create a persona with specific quote
persona = Persona(
    id='test-001',
    name='Test',
    goals=[],
    pain_points=[],
    behaviours=[],
    quotes=['I absolutely hate slow software systems']
)

# Create a card that leaks the quote directly
card = CharacterCard(
    id='script-001',
    identity=Identity(name='Test', title='Test'),
    psychological_profile=PsychologicalProfile(
        goals=[],
        motivations=[],
        pain_points=['I absolutely hate slow software systems'],  # Direct leak!
        personality_traits=[],
        flaws=[]
    ),
    communication_style=CommunicationStyle(
        tone='frustrated',
        vocabulary_level='professional',
        speech_patterns=[]
    ),
    knowledge_boundaries=KnowledgeBoundaries(knows=[], doesnt_know=[], can_infer=[]),
    guidelines=Guidelines(
        response_style='test',
        uncertainty_handling='test',
        character_maintenance='test',
        additional_rules=[]
    ),
    provenance=Provenance(source_persona_id='test-001')
)

auditor = PrivacyAuditor()
result = auditor.audit(card, persona)
print(f'Privacy audit passed: {result.passed}')
print(f'Blocked: {result.blocked}')
print(f'Leakage score: {result.leakage_score:.3f}')
print(f'Leakages detected: {len(result.leakages)}')
"
```
- [ ] Privacy audit FAILS (passed=False)
- [ ] Output is blocked
- [ ] Leakage detected

### 10. All Tests Pass
```bash
pytest tests/ -q
```
- [ ] All 961 tests pass

## Report

- **Version**: v0.4.0
- **Date**: ___
- **Result**: PASS / FAIL
- **Notes**: ___
