# Manual Test Script: v0.7.0 - Batch Processing

This script verifies all v0.7.0 functionality. Execute tests in order and record results.

## Prerequisites

- Python 3.12+
- Git checkout of v0.7.0 tag
- No API keys required (tests use mock responses)

## Installation

```bash
# 1. Checkout the version
git checkout v0.7.0

# 2. Create fresh virtual environment
python3.12 -m venv .venv-test
source .venv-test/bin/activate  # On Windows: .venv-test\Scripts\activate

# 3. Install Persona with all dependencies
pip install -e ".[all]"

# 4. Verify installation
python -c "import persona; print(f'Persona v{persona.__version__}')"
```

**Expected:** Shows Persona v0.7.0

---

## Test 1: Folder Scanner (F-059)

**Command:**
```bash
python -c "from persona.core.batch import FolderScanner; print('FolderScanner available')"
```

**Expected:** Prints "FolderScanner available"

**Pass Criteria:**
- [ ] FolderScanner imports successfully

**Command:**
```bash
python -c "
from persona.core.batch import FolderScanner
from pathlib import Path

# Create test directory
test_dir = Path('/tmp/persona_test')
test_dir.mkdir(exist_ok=True)
(test_dir / 'test.md').write_text('# Test')
(test_dir / 'data.csv').write_text('id,text\n1,hello')

scanner = FolderScanner()
result = scanner.scan(test_dir)
print(f'Scanned {result.total_files} files')
"
```

**Expected:** Scans directory and finds files

**Pass Criteria:**
- [ ] Scans directory and finds files

---

## Test 2: File Combiner (F-060)

**Command:**
```bash
python -c "
from persona.core.batch import FileCombiner, SeparatorStyle
from persona.core.batch.combiner import FileContent
from pathlib import Path

combiner = FileCombiner(style=SeparatorStyle.STANDARD)
files = [
    FileContent(Path('a.md'), 'Content A', 'markdown', 9),
    FileContent(Path('b.md'), 'Content B', 'markdown', 9),
]
result = combiner.combine(files)
print(f'Combined {result.source_count} files')
print(f'Combined content length: {len(result.content)} chars')
"
```

**Expected:** FileCombiner combines multiple files, separator styles work correctly

**Pass Criteria:**
- [ ] FileCombiner combines multiple files
- [ ] Separator styles work correctly

---

## Test 3: Flexible Persona Count (F-061)

**Command:**
```bash
python -c "
from persona.core.batch import parse_count, CountType

# Test various formats
specs = [
    ('3', CountType.EXACT),
    ('3-5', CountType.RANGE),
    ('~4', CountType.APPROXIMATE),
    ('at least 3', CountType.MINIMUM),
]
for input_str, expected in specs:
    spec = parse_count(input_str)
    assert spec.count_type == expected, f'Failed for {input_str}'
    print(f'Parsed \"{input_str}\" as {spec.count_type.value}')
print('All count formats work')
"
```

**Expected:** Exact counts parsed correctly, range counts parsed correctly, approximate counts parsed correctly, minimum counts parsed correctly

**Pass Criteria:**
- [ ] Exact counts parsed correctly
- [ ] Range counts parsed correctly
- [ ] Approximate counts parsed correctly
- [ ] Minimum counts parsed correctly

---

## Test 4: Context Window Awareness (F-062)

**Command:**
```bash
python -c "
from persona.core.batch import ContextManager, WarningLevel

manager = ContextManager()

# Test known model
window = manager.get_context_window('claude-sonnet-4-20250514')
print(f'Claude Sonnet 4.5 context: {window:,} tokens')

# Test budget calculation
budget = manager.calculate_budget(
    model='gpt-4o',
    system_tokens=3000,
    input_tokens=50000,
)
print(f'Budget: {budget.usage_percentage:.1f}% used')

# Test warning
warning = manager.check_warning(budget)
status = 'No warning' if warning is None else f'{warning.level.value} warning'
print(f'Warning check: {status}')
"
```

**Expected:** Context windows configured for major models, budget calculations work, warning thresholds function

**Pass Criteria:**
- [ ] Context windows configured for major models
- [ ] Budget calculations work
- [ ] Warning thresholds function

---

## Test 5: Token Count Tracking (F-063)

**Command:**
```bash
python -c "
from persona.core.batch import TokenCounter

counter = TokenCounter(use_tiktoken=True)

# Count tokens
count = counter.count_tokens('Hello, world! This is a test.', model='gpt-4o')
print(f'Token count: {count} tokens')

# Record usage
counter.record_usage(1000, 500, 'gpt-4o', step='generation')
counter.record_usage(500, 200, 'gpt-4o', step='validation')
summary = counter.get_summary()
print(f'Total tokens tracked: {summary[\"total_tokens\"]}')
print(f'LLM calls recorded: {summary[\"calls\"]}')
"
```

**Expected:** Token counting works, usage tracking records correctly, summary reports accurate totals

**Pass Criteria:**
- [ ] Token counting works
- [ ] Usage tracking records correctly
- [ ] Summary reports accurate totals

---

## Test 6: Data File Listing (F-064)

**Command:**
```bash
python -c "
from persona.core.batch import DataSourceTracker
from pathlib import Path

# Create test files
test_dir = Path('/tmp/persona_test')
test_dir.mkdir(exist_ok=True)
(test_dir / 'source.md').write_text('# Source Data')

tracker = DataSourceTracker(base_path=test_dir)
tracker.add_file(test_dir / 'source.md')

summary = tracker.get_summary()
print(f'Tracked {summary.total_files} files')
print(f'Total size: {summary.total_size_bytes} bytes')

readme = tracker.generate_readme_section()
print(f'README section generated ({len(readme)} chars)')
"
```

**Expected:** File tracking works, SHA256 hashes generated, README section generates correctly

**Pass Criteria:**
- [ ] File tracking works
- [ ] SHA256 hashes generated
- [ ] README section generates correctly

---

## Test 7: Persona Count Estimation (F-065)

**Command:**
```bash
python -c "
from persona.core.batch import PersonaEstimator

estimator = PersonaEstimator()

# Estimate with sample data
content = 'User feedback about product features. ' * 1000
estimate = estimator.estimate(
    content=content,
    file_count=5,
)

print(f'Recommended: {estimate.recommended} personas')
print(f'Range: {estimate.min_count}-{estimate.max_count}')
print(f'Confidence: {estimate.confidence:.0%}')
print(f'Factors: {estimate.factors.total_tokens:,} tokens, {estimate.factors.theme_count} themes')
"
```

**Expected:** Estimation produces reasonable recommendations, confidence scoring works, theme extraction identifies patterns

**Pass Criteria:**
- [ ] Estimation produces reasonable recommendations
- [ ] Confidence scoring works
- [ ] Theme extraction identifies patterns

---

## Test 8: Run Automated Tests

**Command:**
```bash
pytest tests/unit/core/batch/ -v --tb=short
```

**Expected:** All batch processing tests pass

**Pass Criteria:**
- [ ] All tests pass

---

## Test 9: Cleanup

**Command:**
```bash
rm -rf /tmp/persona_test
```

**Expected:** Test directory cleaned up

**Pass Criteria:**
- [ ] Test directory cleaned up

---

## Results Summary

| Test | Status | Notes |
|------|--------|-------|
| 1. Folder Scanner | ⬜ | |
| 2. File Combiner | ⬜ | |
| 3. Flexible Persona Count | ⬜ | |
| 4. Context Window Awareness | ⬜ | |
| 5. Token Count Tracking | ⬜ | |
| 6. Data File Listing | ⬜ | |
| 7. Persona Count Estimation | ⬜ | |
| 8. Automated Tests | ⬜ | |
| 9. Cleanup | ⬜ | |

**Overall Result:** ⬜ Pass / ⬜ Fail

---

## Sharing Results

After completing all tests, share:

1. The completed results table above
2. Console output from any failed tests
3. Your environment details:
   - OS:
   - Python version:
   - Any issues encountered

Paste results to Claude for review.
