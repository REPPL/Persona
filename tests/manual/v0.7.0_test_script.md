# Manual Test Script: v0.7.0 - Batch Processing

**Duration:** 5-10 minutes
**Prerequisites:** Python 3.12+, `.venv/` activated

---

## Quick Verification Checklist

### 1. Folder Scanner (F-059)

```bash
# Verify FolderScanner imports
python -c "from persona.core.batch import FolderScanner; print('✓ FolderScanner available')"

# Test scanning sample data
python -c "
from persona.core.batch import FolderScanner
from pathlib import Path

# Create test directory
test_dir = Path('/tmp/persona_test')
test_dir.mkdir(exist_ok=True)
(test_dir / 'test.md').write_text('# Test')
(test_dir / 'data.csv').write_text('id,text\n1,hello')

scanner = FolderScanner()
result = scanner.scan(test_dir)
print(f'✓ Scanned {result.total_files} files')
"
```
- [ ] FolderScanner imports successfully
- [ ] Scans directory and finds files

### 2. File Combiner (F-060)

```bash
python -c "
from persona.core.batch import FileCombiner, SeparatorStyle
from persona.core.batch.combiner import FileContent
from pathlib import Path

combiner = FileCombiner(style=SeparatorStyle.STANDARD)
files = [
    FileContent(Path('a.md'), 'Content A', 'markdown', 9),
    FileContent(Path('b.md'), 'Content B', 'markdown', 9),
]
result = combiner.combine(files)
print(f'✓ Combined {result.source_count} files')
print(f'✓ Combined content length: {len(result.content)} chars')
"
```
- [ ] FileCombiner combines multiple files
- [ ] Separator styles work correctly

### 3. Flexible Persona Count (F-061)

```bash
python -c "
from persona.core.batch import parse_count, CountType

# Test various formats
specs = [
    ('3', CountType.EXACT),
    ('3-5', CountType.RANGE),
    ('~4', CountType.APPROXIMATE),
    ('at least 3', CountType.MINIMUM),
]
for input_str, expected in specs:
    spec = parse_count(input_str)
    assert spec.count_type == expected, f'Failed for {input_str}'
    print(f'✓ Parsed \"{input_str}\" as {spec.count_type.value}')
print('✓ All count formats work')
"
```
- [ ] Exact counts parsed correctly
- [ ] Range counts parsed correctly
- [ ] Approximate counts parsed correctly
- [ ] Minimum counts parsed correctly

### 4. Context Window Awareness (F-062)

```bash
python -c "
from persona.core.batch import ContextManager, WarningLevel

manager = ContextManager()

# Test known model
window = manager.get_context_window('claude-sonnet-4-20250514')
print(f'✓ Claude Sonnet 4.5 context: {window:,} tokens')

# Test budget calculation
budget = manager.calculate_budget(
    model='gpt-4o',
    system_tokens=3000,
    input_tokens=50000,
)
print(f'✓ Budget: {budget.usage_percentage:.1f}% used')

# Test warning
warning = manager.check_warning(budget)
status = 'No warning' if warning is None else f'{warning.level.value} warning'
print(f'✓ Warning check: {status}')
"
```
- [ ] Context windows configured for major models
- [ ] Budget calculations work
- [ ] Warning thresholds function

### 5. Token Count Tracking (F-063)

```bash
python -c "
from persona.core.batch import TokenCounter

counter = TokenCounter(use_tiktoken=True)

# Count tokens
count = counter.count_tokens('Hello, world! This is a test.', model='gpt-4o')
print(f'✓ Token count: {count} tokens')

# Record usage
counter.record_usage(1000, 500, 'gpt-4o', step='generation')
counter.record_usage(500, 200, 'gpt-4o', step='validation')
summary = counter.get_summary()
print(f'✓ Total tokens tracked: {summary[\"total_tokens\"]}')
print(f'✓ LLM calls recorded: {summary[\"calls\"]}')
"
```
- [ ] Token counting works
- [ ] Usage tracking records correctly
- [ ] Summary reports accurate totals

### 6. Data File Listing (F-064)

```bash
python -c "
from persona.core.batch import DataSourceTracker
from pathlib import Path

# Create test files
test_dir = Path('/tmp/persona_test')
test_dir.mkdir(exist_ok=True)
(test_dir / 'source.md').write_text('# Source Data')

tracker = DataSourceTracker(base_path=test_dir)
tracker.add_file(test_dir / 'source.md')

summary = tracker.get_summary()
print(f'✓ Tracked {summary.total_files} files')
print(f'✓ Total size: {summary.total_size_bytes} bytes')

readme = tracker.generate_readme_section()
print(f'✓ README section generated ({len(readme)} chars)')
"
```
- [ ] File tracking works
- [ ] SHA256 hashes generated
- [ ] README section generates correctly

### 7. Persona Count Estimation (F-065)

```bash
python -c "
from persona.core.batch import PersonaEstimator

estimator = PersonaEstimator()

# Estimate with sample data
content = 'User feedback about product features. ' * 1000
estimate = estimator.estimate(
    content=content,
    file_count=5,
)

print(f'✓ Recommended: {estimate.recommended} personas')
print(f'✓ Range: {estimate.min_count}-{estimate.max_count}')
print(f'✓ Confidence: {estimate.confidence:.0%}')
print(f'✓ Factors: {estimate.factors.total_tokens:,} tokens, {estimate.factors.theme_count} themes')
"
```
- [ ] Estimation produces reasonable recommendations
- [ ] Confidence scoring works
- [ ] Theme extraction identifies patterns

---

## Report

| Test | Status | Notes |
|------|--------|-------|
| F-059 Folder Scanner | ☐ PASS / ☐ FAIL | |
| F-060 File Combiner | ☐ PASS / ☐ FAIL | |
| F-061 Flexible Count | ☐ PASS / ☐ FAIL | |
| F-062 Context Awareness | ☐ PASS / ☐ FAIL | |
| F-063 Token Tracking | ☐ PASS / ☐ FAIL | |
| F-064 Data Listing | ☐ PASS / ☐ FAIL | |
| F-065 Count Estimation | ☐ PASS / ☐ FAIL | |

**Overall Result:** ☐ PASS / ☐ FAIL

**Tester:** _________________
**Date:** _________________
**Environment:** _________________

---

## Cleanup

```bash
rm -rf /tmp/persona_test
```
